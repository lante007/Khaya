{
 "Description": "ProjectKhaya.co.za - Serverless Marketplace Infrastructure",
 "Resources": {
  "UsersTable9725E9C8": {
   "Type": "AWS::DynamoDB::Table",
   "Properties": {
    "AttributeDefinitions": [
     {
      "AttributeName": "id",
      "AttributeType": "S"
     },
     {
      "AttributeName": "email",
      "AttributeType": "S"
     },
     {
      "AttributeName": "phone",
      "AttributeType": "S"
     }
    ],
    "BillingMode": "PAY_PER_REQUEST",
    "GlobalSecondaryIndexes": [
     {
      "IndexName": "EmailIndex",
      "KeySchema": [
       {
        "AttributeName": "email",
        "KeyType": "HASH"
       }
      ],
      "Projection": {
       "ProjectionType": "ALL"
      }
     },
     {
      "IndexName": "PhoneIndex",
      "KeySchema": [
       {
        "AttributeName": "phone",
        "KeyType": "HASH"
       }
      ],
      "Projection": {
       "ProjectionType": "ALL"
      }
     }
    ],
    "KeySchema": [
     {
      "AttributeName": "id",
      "KeyType": "HASH"
     }
    ],
    "PointInTimeRecoverySpecification": {
     "PointInTimeRecoveryEnabled": true
    },
    "StreamSpecification": {
     "StreamViewType": "NEW_AND_OLD_IMAGES"
    }
   },
   "UpdateReplacePolicy": "Retain",
   "DeletionPolicy": "Retain",
   "Metadata": {
    "aws:cdk:path": "KhayaStack/UsersTable/Resource"
   }
  },
  "ProfilesTable3B48B4C6": {
   "Type": "AWS::DynamoDB::Table",
   "Properties": {
    "AttributeDefinitions": [
     {
      "AttributeName": "userId",
      "AttributeType": "S"
     },
     {
      "AttributeName": "location",
      "AttributeType": "S"
     },
     {
      "AttributeName": "trustScore",
      "AttributeType": "N"
     }
    ],
    "BillingMode": "PAY_PER_REQUEST",
    "GlobalSecondaryIndexes": [
     {
      "IndexName": "LocationIndex",
      "KeySchema": [
       {
        "AttributeName": "location",
        "KeyType": "HASH"
       },
       {
        "AttributeName": "trustScore",
        "KeyType": "RANGE"
       }
      ],
      "Projection": {
       "ProjectionType": "ALL"
      }
     }
    ],
    "KeySchema": [
     {
      "AttributeName": "userId",
      "KeyType": "HASH"
     }
    ],
    "StreamSpecification": {
     "StreamViewType": "NEW_AND_OLD_IMAGES"
    }
   },
   "UpdateReplacePolicy": "Retain",
   "DeletionPolicy": "Retain",
   "Metadata": {
    "aws:cdk:path": "KhayaStack/ProfilesTable/Resource"
   }
  },
  "JobsTable1970BC16": {
   "Type": "AWS::DynamoDB::Table",
   "Properties": {
    "AttributeDefinitions": [
     {
      "AttributeName": "id",
      "AttributeType": "S"
     },
     {
      "AttributeName": "createdAt",
      "AttributeType": "S"
     },
     {
      "AttributeName": "status",
      "AttributeType": "S"
     }
    ],
    "BillingMode": "PAY_PER_REQUEST",
    "GlobalSecondaryIndexes": [
     {
      "IndexName": "StatusIndex",
      "KeySchema": [
       {
        "AttributeName": "status",
        "KeyType": "HASH"
       },
       {
        "AttributeName": "createdAt",
        "KeyType": "RANGE"
       }
      ],
      "Projection": {
       "ProjectionType": "ALL"
      }
     }
    ],
    "KeySchema": [
     {
      "AttributeName": "id",
      "KeyType": "HASH"
     },
     {
      "AttributeName": "createdAt",
      "KeyType": "RANGE"
     }
    ],
    "StreamSpecification": {
     "StreamViewType": "NEW_AND_OLD_IMAGES"
    }
   },
   "UpdateReplacePolicy": "Retain",
   "DeletionPolicy": "Retain",
   "Metadata": {
    "aws:cdk:path": "KhayaStack/JobsTable/Resource"
   }
  },
  "BidsTableE1AD1632": {
   "Type": "AWS::DynamoDB::Table",
   "Properties": {
    "AttributeDefinitions": [
     {
      "AttributeName": "id",
      "AttributeType": "S"
     },
     {
      "AttributeName": "jobId",
      "AttributeType": "S"
     },
     {
      "AttributeName": "amount",
      "AttributeType": "N"
     }
    ],
    "BillingMode": "PAY_PER_REQUEST",
    "GlobalSecondaryIndexes": [
     {
      "IndexName": "JobIndex",
      "KeySchema": [
       {
        "AttributeName": "jobId",
        "KeyType": "HASH"
       },
       {
        "AttributeName": "amount",
        "KeyType": "RANGE"
       }
      ],
      "Projection": {
       "ProjectionType": "ALL"
      }
     }
    ],
    "KeySchema": [
     {
      "AttributeName": "id",
      "KeyType": "HASH"
     },
     {
      "AttributeName": "jobId",
      "KeyType": "RANGE"
     }
    ]
   },
   "UpdateReplacePolicy": "Retain",
   "DeletionPolicy": "Retain",
   "Metadata": {
    "aws:cdk:path": "KhayaStack/BidsTable/Resource"
   }
  },
  "ListingsTableCCEBB5D2": {
   "Type": "AWS::DynamoDB::Table",
   "Properties": {
    "AttributeDefinitions": [
     {
      "AttributeName": "id",
      "AttributeType": "S"
     },
     {
      "AttributeName": "category",
      "AttributeType": "S"
     },
     {
      "AttributeName": "createdAt",
      "AttributeType": "S"
     }
    ],
    "BillingMode": "PAY_PER_REQUEST",
    "GlobalSecondaryIndexes": [
     {
      "IndexName": "CategoryIndex",
      "KeySchema": [
       {
        "AttributeName": "category",
        "KeyType": "HASH"
       },
       {
        "AttributeName": "createdAt",
        "KeyType": "RANGE"
       }
      ],
      "Projection": {
       "ProjectionType": "ALL"
      }
     }
    ],
    "KeySchema": [
     {
      "AttributeName": "id",
      "KeyType": "HASH"
     }
    ]
   },
   "UpdateReplacePolicy": "Retain",
   "DeletionPolicy": "Retain",
   "Metadata": {
    "aws:cdk:path": "KhayaStack/ListingsTable/Resource"
   }
  },
  "ReviewsTable1E51AE49": {
   "Type": "AWS::DynamoDB::Table",
   "Properties": {
    "AttributeDefinitions": [
     {
      "AttributeName": "id",
      "AttributeType": "S"
     },
     {
      "AttributeName": "reviewedId",
      "AttributeType": "S"
     }
    ],
    "BillingMode": "PAY_PER_REQUEST",
    "KeySchema": [
     {
      "AttributeName": "id",
      "KeyType": "HASH"
     },
     {
      "AttributeName": "reviewedId",
      "KeyType": "RANGE"
     }
    ]
   },
   "UpdateReplacePolicy": "Retain",
   "DeletionPolicy": "Retain",
   "Metadata": {
    "aws:cdk:path": "KhayaStack/ReviewsTable/Resource"
   }
  },
  "CreditsTable13AC5EA8": {
   "Type": "AWS::DynamoDB::Table",
   "Properties": {
    "AttributeDefinitions": [
     {
      "AttributeName": "id",
      "AttributeType": "S"
     },
     {
      "AttributeName": "userId",
      "AttributeType": "S"
     }
    ],
    "BillingMode": "PAY_PER_REQUEST",
    "KeySchema": [
     {
      "AttributeName": "id",
      "KeyType": "HASH"
     },
     {
      "AttributeName": "userId",
      "KeyType": "RANGE"
     }
    ]
   },
   "UpdateReplacePolicy": "Retain",
   "DeletionPolicy": "Retain",
   "Metadata": {
    "aws:cdk:path": "KhayaStack/CreditsTable/Resource"
   }
  },
  "ReferralsTable2A6E2E9C": {
   "Type": "AWS::DynamoDB::Table",
   "Properties": {
    "AttributeDefinitions": [
     {
      "AttributeName": "id",
      "AttributeType": "S"
     },
     {
      "AttributeName": "referralCode",
      "AttributeType": "S"
     }
    ],
    "BillingMode": "PAY_PER_REQUEST",
    "GlobalSecondaryIndexes": [
     {
      "IndexName": "CodeIndex",
      "KeySchema": [
       {
        "AttributeName": "referralCode",
        "KeyType": "HASH"
       }
      ],
      "Projection": {
       "ProjectionType": "ALL"
      }
     }
    ],
    "KeySchema": [
     {
      "AttributeName": "id",
      "KeyType": "HASH"
     }
    ]
   },
   "UpdateReplacePolicy": "Retain",
   "DeletionPolicy": "Retain",
   "Metadata": {
    "aws:cdk:path": "KhayaStack/ReferralsTable/Resource"
   }
  },
  "StoriesTableF145CECC": {
   "Type": "AWS::DynamoDB::Table",
   "Properties": {
    "AttributeDefinitions": [
     {
      "AttributeName": "id",
      "AttributeType": "S"
     },
     {
      "AttributeName": "createdAt",
      "AttributeType": "S"
     }
    ],
    "BillingMode": "PAY_PER_REQUEST",
    "KeySchema": [
     {
      "AttributeName": "id",
      "KeyType": "HASH"
     },
     {
      "AttributeName": "createdAt",
      "KeyType": "RANGE"
     }
    ]
   },
   "UpdateReplacePolicy": "Retain",
   "DeletionPolicy": "Retain",
   "Metadata": {
    "aws:cdk:path": "KhayaStack/StoriesTable/Resource"
   }
  },
  "KhayaUserPoolsmsRoleA7549BCE": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Condition": {
        "StringEquals": {
         "sts:ExternalId": "KhayaStackKhayaUserPool8AD7DA64"
        }
       },
       "Effect": "Allow",
       "Principal": {
        "Service": "cognito-idp.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "Policies": [
     {
      "PolicyDocument": {
       "Statement": [
        {
         "Action": "sns:Publish",
         "Effect": "Allow",
         "Resource": "*"
        }
       ],
       "Version": "2012-10-17"
      },
      "PolicyName": "sns-publish"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "KhayaStack/KhayaUserPool/smsRole/Resource"
   }
  },
  "KhayaUserPool64146B1C": {
   "Type": "AWS::Cognito::UserPool",
   "Properties": {
    "AccountRecoverySetting": {
     "RecoveryMechanisms": [
      {
       "Name": "verified_phone_number",
       "Priority": 1
      }
     ]
    },
    "AdminCreateUserConfig": {
     "AllowAdminCreateUserOnly": false
    },
    "AutoVerifiedAttributes": [
     "phone_number"
    ],
    "EmailVerificationMessage": "The verification code to your new account is {####}",
    "EmailVerificationSubject": "Verify your new account",
    "Policies": {
     "PasswordPolicy": {
      "MinimumLength": 8,
      "RequireLowercase": true,
      "RequireNumbers": true,
      "RequireSymbols": false,
      "RequireUppercase": false
     }
    },
    "Schema": [
     {
      "Mutable": true,
      "Name": "phone_number",
      "Required": true
     },
     {
      "Mutable": true,
      "Name": "email",
      "Required": false
     },
     {
      "AttributeDataType": "String",
      "Mutable": true,
      "Name": "role",
      "StringAttributeConstraints": {
       "MaxLength": "20",
       "MinLength": "1"
      }
     }
    ],
    "SmsConfiguration": {
     "ExternalId": "KhayaStackKhayaUserPool8AD7DA64",
     "SnsCallerArn": {
      "Fn::GetAtt": [
       "KhayaUserPoolsmsRoleA7549BCE",
       "Arn"
      ]
     }
    },
    "SmsVerificationMessage": "The verification code to your new account is {####}",
    "UsernameAttributes": [
     "email",
     "phone_number"
    ],
    "VerificationMessageTemplate": {
     "DefaultEmailOption": "CONFIRM_WITH_CODE",
     "EmailMessage": "The verification code to your new account is {####}",
     "EmailSubject": "Verify your new account",
     "SmsMessage": "The verification code to your new account is {####}"
    }
   },
   "UpdateReplacePolicy": "Retain",
   "DeletionPolicy": "Retain",
   "Metadata": {
    "aws:cdk:path": "KhayaStack/KhayaUserPool/Resource"
   }
  },
  "KhayaAppClient7533AECC": {
   "Type": "AWS::Cognito::UserPoolClient",
   "Properties": {
    "AllowedOAuthFlows": [
     "implicit",
     "code"
    ],
    "AllowedOAuthFlowsUserPoolClient": true,
    "AllowedOAuthScopes": [
     "profile",
     "phone",
     "email",
     "openid",
     "aws.cognito.signin.user.admin"
    ],
    "CallbackURLs": [
     "https://example.com"
    ],
    "ExplicitAuthFlows": [
     "ALLOW_USER_PASSWORD_AUTH",
     "ALLOW_USER_SRP_AUTH",
     "ALLOW_REFRESH_TOKEN_AUTH"
    ],
    "GenerateSecret": false,
    "SupportedIdentityProviders": [
     "COGNITO"
    ],
    "UserPoolId": {
     "Ref": "KhayaUserPool64146B1C"
    }
   },
   "Metadata": {
    "aws:cdk:path": "KhayaStack/KhayaAppClient/Resource"
   }
  },
  "KhayaStorageBucket6A5AFBEB": {
   "Type": "AWS::S3::Bucket",
   "Properties": {
    "CorsConfiguration": {
     "CorsRules": [
      {
       "AllowedHeaders": [
        "*"
       ],
       "AllowedMethods": [
        "GET",
        "PUT",
        "POST"
       ],
       "AllowedOrigins": [
        "*"
       ]
      }
     ]
    }
   },
   "UpdateReplacePolicy": "Retain",
   "DeletionPolicy": "Retain",
   "Metadata": {
    "aws:cdk:path": "KhayaStack/KhayaStorageBucket/Resource"
   }
  },
  "ApiLambdaServiceRole1CC7D0F3": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "lambda.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
       ]
      ]
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "KhayaStack/ApiLambda/ServiceRole/Resource"
   }
  },
  "ApiLambdaServiceRoleDefaultPolicyF1B57697": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "dynamodb:BatchGetItem",
        "dynamodb:GetRecords",
        "dynamodb:GetShardIterator",
        "dynamodb:Query",
        "dynamodb:GetItem",
        "dynamodb:Scan",
        "dynamodb:ConditionCheckItem",
        "dynamodb:BatchWriteItem",
        "dynamodb:PutItem",
        "dynamodb:UpdateItem",
        "dynamodb:DeleteItem",
        "dynamodb:DescribeTable"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "UsersTable9725E9C8",
          "Arn"
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "UsersTable9725E9C8",
             "Arn"
            ]
           },
           "/index/*"
          ]
         ]
        }
       ]
      },
      {
       "Action": [
        "dynamodb:BatchGetItem",
        "dynamodb:GetRecords",
        "dynamodb:GetShardIterator",
        "dynamodb:Query",
        "dynamodb:GetItem",
        "dynamodb:Scan",
        "dynamodb:ConditionCheckItem",
        "dynamodb:BatchWriteItem",
        "dynamodb:PutItem",
        "dynamodb:UpdateItem",
        "dynamodb:DeleteItem",
        "dynamodb:DescribeTable"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "ProfilesTable3B48B4C6",
          "Arn"
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "ProfilesTable3B48B4C6",
             "Arn"
            ]
           },
           "/index/*"
          ]
         ]
        }
       ]
      },
      {
       "Action": [
        "dynamodb:BatchGetItem",
        "dynamodb:GetRecords",
        "dynamodb:GetShardIterator",
        "dynamodb:Query",
        "dynamodb:GetItem",
        "dynamodb:Scan",
        "dynamodb:ConditionCheckItem",
        "dynamodb:BatchWriteItem",
        "dynamodb:PutItem",
        "dynamodb:UpdateItem",
        "dynamodb:DeleteItem",
        "dynamodb:DescribeTable"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "JobsTable1970BC16",
          "Arn"
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "JobsTable1970BC16",
             "Arn"
            ]
           },
           "/index/*"
          ]
         ]
        }
       ]
      },
      {
       "Action": [
        "dynamodb:BatchGetItem",
        "dynamodb:GetRecords",
        "dynamodb:GetShardIterator",
        "dynamodb:Query",
        "dynamodb:GetItem",
        "dynamodb:Scan",
        "dynamodb:ConditionCheckItem",
        "dynamodb:BatchWriteItem",
        "dynamodb:PutItem",
        "dynamodb:UpdateItem",
        "dynamodb:DeleteItem",
        "dynamodb:DescribeTable"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "BidsTableE1AD1632",
          "Arn"
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "BidsTableE1AD1632",
             "Arn"
            ]
           },
           "/index/*"
          ]
         ]
        }
       ]
      },
      {
       "Action": [
        "dynamodb:BatchGetItem",
        "dynamodb:GetRecords",
        "dynamodb:GetShardIterator",
        "dynamodb:Query",
        "dynamodb:GetItem",
        "dynamodb:Scan",
        "dynamodb:ConditionCheckItem",
        "dynamodb:BatchWriteItem",
        "dynamodb:PutItem",
        "dynamodb:UpdateItem",
        "dynamodb:DeleteItem",
        "dynamodb:DescribeTable"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "ListingsTableCCEBB5D2",
          "Arn"
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "ListingsTableCCEBB5D2",
             "Arn"
            ]
           },
           "/index/*"
          ]
         ]
        }
       ]
      },
      {
       "Action": [
        "dynamodb:BatchGetItem",
        "dynamodb:GetRecords",
        "dynamodb:GetShardIterator",
        "dynamodb:Query",
        "dynamodb:GetItem",
        "dynamodb:Scan",
        "dynamodb:ConditionCheckItem",
        "dynamodb:BatchWriteItem",
        "dynamodb:PutItem",
        "dynamodb:UpdateItem",
        "dynamodb:DeleteItem",
        "dynamodb:DescribeTable"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "ReviewsTable1E51AE49",
          "Arn"
         ]
        },
        {
         "Ref": "AWS::NoValue"
        }
       ]
      },
      {
       "Action": [
        "dynamodb:BatchGetItem",
        "dynamodb:GetRecords",
        "dynamodb:GetShardIterator",
        "dynamodb:Query",
        "dynamodb:GetItem",
        "dynamodb:Scan",
        "dynamodb:ConditionCheckItem",
        "dynamodb:BatchWriteItem",
        "dynamodb:PutItem",
        "dynamodb:UpdateItem",
        "dynamodb:DeleteItem",
        "dynamodb:DescribeTable"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "CreditsTable13AC5EA8",
          "Arn"
         ]
        },
        {
         "Ref": "AWS::NoValue"
        }
       ]
      },
      {
       "Action": [
        "dynamodb:BatchGetItem",
        "dynamodb:GetRecords",
        "dynamodb:GetShardIterator",
        "dynamodb:Query",
        "dynamodb:GetItem",
        "dynamodb:Scan",
        "dynamodb:ConditionCheckItem",
        "dynamodb:BatchWriteItem",
        "dynamodb:PutItem",
        "dynamodb:UpdateItem",
        "dynamodb:DeleteItem",
        "dynamodb:DescribeTable"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "ReferralsTable2A6E2E9C",
          "Arn"
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "ReferralsTable2A6E2E9C",
             "Arn"
            ]
           },
           "/index/*"
          ]
         ]
        }
       ]
      },
      {
       "Action": [
        "dynamodb:BatchGetItem",
        "dynamodb:GetRecords",
        "dynamodb:GetShardIterator",
        "dynamodb:Query",
        "dynamodb:GetItem",
        "dynamodb:Scan",
        "dynamodb:ConditionCheckItem",
        "dynamodb:BatchWriteItem",
        "dynamodb:PutItem",
        "dynamodb:UpdateItem",
        "dynamodb:DeleteItem",
        "dynamodb:DescribeTable"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "StoriesTableF145CECC",
          "Arn"
         ]
        },
        {
         "Ref": "AWS::NoValue"
        }
       ]
      },
      {
       "Action": [
        "s3:GetObject*",
        "s3:GetBucket*",
        "s3:List*",
        "s3:DeleteObject*",
        "s3:PutObject",
        "s3:PutObjectLegalHold",
        "s3:PutObjectRetention",
        "s3:PutObjectTagging",
        "s3:PutObjectVersionTagging",
        "s3:Abort*"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "KhayaStorageBucket6A5AFBEB",
          "Arn"
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "KhayaStorageBucket6A5AFBEB",
             "Arn"
            ]
           },
           "/*"
          ]
         ]
        }
       ]
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "ApiLambdaServiceRoleDefaultPolicyF1B57697",
    "Roles": [
     {
      "Ref": "ApiLambdaServiceRole1CC7D0F3"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "KhayaStack/ApiLambda/ServiceRole/DefaultPolicy/Resource"
   }
  },
  "ApiLambda91D2282D": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Code": {
     "S3Bucket": "cdk-hnb659fds-assets-615608124862-us-east-1",
     "S3Key": "4ae29b0fd63361d2386e24e8bc1b8451389a151a5c2fba3f3a70b6461e30da59.zip"
    },
    "Environment": {
     "Variables": {
      "USERS_TABLE": {
       "Ref": "UsersTable9725E9C8"
      },
      "PROFILES_TABLE": {
       "Ref": "ProfilesTable3B48B4C6"
      },
      "JOBS_TABLE": {
       "Ref": "JobsTable1970BC16"
      },
      "BIDS_TABLE": {
       "Ref": "BidsTableE1AD1632"
      },
      "LISTINGS_TABLE": {
       "Ref": "ListingsTableCCEBB5D2"
      },
      "REVIEWS_TABLE": {
       "Ref": "ReviewsTable1E51AE49"
      },
      "CREDITS_TABLE": {
       "Ref": "CreditsTable13AC5EA8"
      },
      "REFERRALS_TABLE": {
       "Ref": "ReferralsTable2A6E2E9C"
      },
      "STORIES_TABLE": {
       "Ref": "StoriesTableF145CECC"
      },
      "STORAGE_BUCKET": {
       "Ref": "KhayaStorageBucket6A5AFBEB"
      },
      "USER_POOL_ID": {
       "Ref": "KhayaUserPool64146B1C"
      },
      "USER_POOL_CLIENT_ID": {
       "Ref": "KhayaAppClient7533AECC"
      }
     }
    },
    "Handler": "index.handler",
    "MemorySize": 512,
    "ReservedConcurrentExecutions": 100,
    "Role": {
     "Fn::GetAtt": [
      "ApiLambdaServiceRole1CC7D0F3",
      "Arn"
     ]
    },
    "Runtime": "nodejs20.x",
    "Timeout": 30
   },
   "DependsOn": [
    "ApiLambdaServiceRoleDefaultPolicyF1B57697",
    "ApiLambdaServiceRole1CC7D0F3"
   ],
   "Metadata": {
    "aws:cdk:path": "KhayaStack/ApiLambda/Resource",
    "aws:asset:path": "asset.4ae29b0fd63361d2386e24e8bc1b8451389a151a5c2fba3f3a70b6461e30da59",
    "aws:asset:is-bundled": false,
    "aws:asset:property": "Code"
   }
  },
  "KhayaAPI20285BE5": {
   "Type": "AWS::ApiGateway::RestApi",
   "Properties": {
    "Description": "ProjectKhaya.co.za Marketplace API",
    "Name": "Khaya Service API"
   },
   "Metadata": {
    "aws:cdk:path": "KhayaStack/KhayaAPI/Resource"
   }
  },
  "KhayaAPICloudWatchRole62351C48": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "apigateway.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/service-role/AmazonAPIGatewayPushToCloudWatchLogs"
       ]
      ]
     }
    ]
   },
   "UpdateReplacePolicy": "Retain",
   "DeletionPolicy": "Retain",
   "Metadata": {
    "aws:cdk:path": "KhayaStack/KhayaAPI/CloudWatchRole/Resource"
   }
  },
  "KhayaAPIAccountA0A1314C": {
   "Type": "AWS::ApiGateway::Account",
   "Properties": {
    "CloudWatchRoleArn": {
     "Fn::GetAtt": [
      "KhayaAPICloudWatchRole62351C48",
      "Arn"
     ]
    }
   },
   "DependsOn": [
    "KhayaAPI20285BE5"
   ],
   "UpdateReplacePolicy": "Retain",
   "DeletionPolicy": "Retain",
   "Metadata": {
    "aws:cdk:path": "KhayaStack/KhayaAPI/Account"
   }
  },
  "KhayaAPIDeployment64E7A1BC89d0c938de7e956a4daee7d1cd1e3d8d": {
   "Type": "AWS::ApiGateway::Deployment",
   "Properties": {
    "Description": "ProjectKhaya.co.za Marketplace API",
    "RestApiId": {
     "Ref": "KhayaAPI20285BE5"
    }
   },
   "DependsOn": [
    "KhayaAPIproxyANY7D9D32A0",
    "KhayaAPIproxyOPTIONSDC2F139B",
    "KhayaAPIproxy8F14319C",
    "KhayaAPIANYFC2C3042",
    "KhayaAPIOPTIONS3C13A18A"
   ],
   "Metadata": {
    "aws:cdk:path": "KhayaStack/KhayaAPI/Deployment/Resource",
    "aws:cdk:do-not-refactor": true
   }
  },
  "KhayaAPIDeploymentStageprodDCC70FD3": {
   "Type": "AWS::ApiGateway::Stage",
   "Properties": {
    "DeploymentId": {
     "Ref": "KhayaAPIDeployment64E7A1BC89d0c938de7e956a4daee7d1cd1e3d8d"
    },
    "MethodSettings": [
     {
      "DataTraceEnabled": false,
      "HttpMethod": "*",
      "ResourcePath": "/*",
      "ThrottlingBurstLimit": 1000,
      "ThrottlingRateLimit": 500
     }
    ],
    "RestApiId": {
     "Ref": "KhayaAPI20285BE5"
    },
    "StageName": "prod"
   },
   "DependsOn": [
    "KhayaAPIAccountA0A1314C"
   ],
   "Metadata": {
    "aws:cdk:path": "KhayaStack/KhayaAPI/DeploymentStage.prod/Resource"
   }
  },
  "KhayaAPIOPTIONS3C13A18A": {
   "Type": "AWS::ApiGateway::Method",
   "Properties": {
    "ApiKeyRequired": false,
    "AuthorizationType": "NONE",
    "HttpMethod": "OPTIONS",
    "Integration": {
     "IntegrationResponses": [
      {
       "ResponseParameters": {
        "method.response.header.Access-Control-Allow-Headers": "'Content-Type,Authorization'",
        "method.response.header.Access-Control-Allow-Origin": "'*'",
        "method.response.header.Access-Control-Allow-Methods": "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'"
       },
       "StatusCode": "204"
      }
     ],
     "RequestTemplates": {
      "application/json": "{ statusCode: 200 }"
     },
     "Type": "MOCK"
    },
    "MethodResponses": [
     {
      "ResponseParameters": {
       "method.response.header.Access-Control-Allow-Headers": true,
       "method.response.header.Access-Control-Allow-Origin": true,
       "method.response.header.Access-Control-Allow-Methods": true
      },
      "StatusCode": "204"
     }
    ],
    "ResourceId": {
     "Fn::GetAtt": [
      "KhayaAPI20285BE5",
      "RootResourceId"
     ]
    },
    "RestApiId": {
     "Ref": "KhayaAPI20285BE5"
    }
   },
   "Metadata": {
    "aws:cdk:path": "KhayaStack/KhayaAPI/Default/OPTIONS/Resource"
   }
  },
  "KhayaAPIproxy8F14319C": {
   "Type": "AWS::ApiGateway::Resource",
   "Properties": {
    "ParentId": {
     "Fn::GetAtt": [
      "KhayaAPI20285BE5",
      "RootResourceId"
     ]
    },
    "PathPart": "{proxy+}",
    "RestApiId": {
     "Ref": "KhayaAPI20285BE5"
    }
   },
   "Metadata": {
    "aws:cdk:path": "KhayaStack/KhayaAPI/Default/{proxy+}/Resource"
   }
  },
  "KhayaAPIproxyOPTIONSDC2F139B": {
   "Type": "AWS::ApiGateway::Method",
   "Properties": {
    "ApiKeyRequired": false,
    "AuthorizationType": "NONE",
    "HttpMethod": "OPTIONS",
    "Integration": {
     "IntegrationResponses": [
      {
       "ResponseParameters": {
        "method.response.header.Access-Control-Allow-Headers": "'Content-Type,Authorization'",
        "method.response.header.Access-Control-Allow-Origin": "'*'",
        "method.response.header.Access-Control-Allow-Methods": "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'"
       },
       "StatusCode": "204"
      }
     ],
     "RequestTemplates": {
      "application/json": "{ statusCode: 200 }"
     },
     "Type": "MOCK"
    },
    "MethodResponses": [
     {
      "ResponseParameters": {
       "method.response.header.Access-Control-Allow-Headers": true,
       "method.response.header.Access-Control-Allow-Origin": true,
       "method.response.header.Access-Control-Allow-Methods": true
      },
      "StatusCode": "204"
     }
    ],
    "ResourceId": {
     "Ref": "KhayaAPIproxy8F14319C"
    },
    "RestApiId": {
     "Ref": "KhayaAPI20285BE5"
    }
   },
   "Metadata": {
    "aws:cdk:path": "KhayaStack/KhayaAPI/Default/{proxy+}/OPTIONS/Resource"
   }
  },
  "KhayaAPIproxyANYApiPermissionKhayaStackKhayaAPI722E000FANYproxy64B5E58D": {
   "Type": "AWS::Lambda::Permission",
   "Properties": {
    "Action": "lambda:InvokeFunction",
    "FunctionName": {
     "Fn::GetAtt": [
      "ApiLambda91D2282D",
      "Arn"
     ]
    },
    "Principal": "apigateway.amazonaws.com",
    "SourceArn": {
     "Fn::Join": [
      "",
      [
       "arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":execute-api:us-east-1:615608124862:",
       {
        "Ref": "KhayaAPI20285BE5"
       },
       "/",
       {
        "Ref": "KhayaAPIDeploymentStageprodDCC70FD3"
       },
       "/*/*"
      ]
     ]
    }
   },
   "Metadata": {
    "aws:cdk:path": "KhayaStack/KhayaAPI/Default/{proxy+}/ANY/ApiPermission.KhayaStackKhayaAPI722E000F.ANY..{proxy+}"
   }
  },
  "KhayaAPIproxyANYApiPermissionTestKhayaStackKhayaAPI722E000FANYproxy7EC7A59A": {
   "Type": "AWS::Lambda::Permission",
   "Properties": {
    "Action": "lambda:InvokeFunction",
    "FunctionName": {
     "Fn::GetAtt": [
      "ApiLambda91D2282D",
      "Arn"
     ]
    },
    "Principal": "apigateway.amazonaws.com",
    "SourceArn": {
     "Fn::Join": [
      "",
      [
       "arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":execute-api:us-east-1:615608124862:",
       {
        "Ref": "KhayaAPI20285BE5"
       },
       "/test-invoke-stage/*/*"
      ]
     ]
    }
   },
   "Metadata": {
    "aws:cdk:path": "KhayaStack/KhayaAPI/Default/{proxy+}/ANY/ApiPermission.Test.KhayaStackKhayaAPI722E000F.ANY..{proxy+}"
   }
  },
  "KhayaAPIproxyANY7D9D32A0": {
   "Type": "AWS::ApiGateway::Method",
   "Properties": {
    "AuthorizationType": "NONE",
    "HttpMethod": "ANY",
    "Integration": {
     "IntegrationHttpMethod": "POST",
     "Type": "AWS_PROXY",
     "Uri": {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":apigateway:us-east-1:lambda:path/2015-03-31/functions/",
        {
         "Fn::GetAtt": [
          "ApiLambda91D2282D",
          "Arn"
         ]
        },
        "/invocations"
       ]
      ]
     }
    },
    "ResourceId": {
     "Ref": "KhayaAPIproxy8F14319C"
    },
    "RestApiId": {
     "Ref": "KhayaAPI20285BE5"
    }
   },
   "Metadata": {
    "aws:cdk:path": "KhayaStack/KhayaAPI/Default/{proxy+}/ANY/Resource"
   }
  },
  "KhayaAPIANYFC2C3042": {
   "Type": "AWS::ApiGateway::Method",
   "Properties": {
    "AuthorizationType": "NONE",
    "HttpMethod": "ANY",
    "Integration": {
     "Type": "MOCK"
    },
    "ResourceId": {
     "Fn::GetAtt": [
      "KhayaAPI20285BE5",
      "RootResourceId"
     ]
    },
    "RestApiId": {
     "Ref": "KhayaAPI20285BE5"
    }
   },
   "Metadata": {
    "aws:cdk:path": "KhayaStack/KhayaAPI/Default/ANY/Resource"
   }
  },
  "KhayaFrontendBucket73A25EBF": {
   "Type": "AWS::S3::Bucket",
   "Properties": {
    "PublicAccessBlockConfiguration": {
     "BlockPublicAcls": false,
     "BlockPublicPolicy": false,
     "IgnorePublicAcls": false,
     "RestrictPublicBuckets": false
    },
    "Tags": [
     {
      "Key": "aws-cdk:auto-delete-objects",
      "Value": "true"
     }
    ],
    "WebsiteConfiguration": {
     "ErrorDocument": "index.html",
     "IndexDocument": "index.html"
    }
   },
   "UpdateReplacePolicy": "Delete",
   "DeletionPolicy": "Delete",
   "Metadata": {
    "aws:cdk:path": "KhayaStack/KhayaFrontendBucket/Resource"
   }
  },
  "KhayaFrontendBucketPolicy76F805CA": {
   "Type": "AWS::S3::BucketPolicy",
   "Properties": {
    "Bucket": {
     "Ref": "KhayaFrontendBucket73A25EBF"
    },
    "PolicyDocument": {
     "Statement": [
      {
       "Action": "s3:GetObject",
       "Effect": "Allow",
       "Principal": {
        "AWS": "*"
       },
       "Resource": {
        "Fn::Join": [
         "",
         [
          {
           "Fn::GetAtt": [
            "KhayaFrontendBucket73A25EBF",
            "Arn"
           ]
          },
          "/*"
         ]
        ]
       }
      },
      {
       "Action": [
        "s3:PutBucketPolicy",
        "s3:GetBucket*",
        "s3:List*",
        "s3:DeleteObject*"
       ],
       "Effect": "Allow",
       "Principal": {
        "AWS": {
         "Fn::GetAtt": [
          "CustomS3AutoDeleteObjectsCustomResourceProviderRole3B1BD092",
          "Arn"
         ]
        }
       },
       "Resource": [
        {
         "Fn::GetAtt": [
          "KhayaFrontendBucket73A25EBF",
          "Arn"
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "KhayaFrontendBucket73A25EBF",
             "Arn"
            ]
           },
           "/*"
          ]
         ]
        }
       ]
      },
      {
       "Action": [
        "s3:GetObject*",
        "s3:GetBucket*",
        "s3:List*"
       ],
       "Effect": "Allow",
       "Principal": {
        "CanonicalUser": {
         "Fn::GetAtt": [
          "OAIE1EFC67F",
          "S3CanonicalUserId"
         ]
        }
       },
       "Resource": [
        {
         "Fn::GetAtt": [
          "KhayaFrontendBucket73A25EBF",
          "Arn"
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "KhayaFrontendBucket73A25EBF",
             "Arn"
            ]
           },
           "/*"
          ]
         ]
        }
       ]
      }
     ],
     "Version": "2012-10-17"
    }
   },
   "Metadata": {
    "aws:cdk:path": "KhayaStack/KhayaFrontendBucket/Policy/Resource"
   }
  },
  "KhayaFrontendBucketAutoDeleteObjectsCustomResource0C34BF2A": {
   "Type": "Custom::S3AutoDeleteObjects",
   "Properties": {
    "ServiceToken": {
     "Fn::GetAtt": [
      "CustomS3AutoDeleteObjectsCustomResourceProviderHandler9D90184F",
      "Arn"
     ]
    },
    "BucketName": {
     "Ref": "KhayaFrontendBucket73A25EBF"
    }
   },
   "DependsOn": [
    "KhayaFrontendBucketPolicy76F805CA"
   ],
   "UpdateReplacePolicy": "Delete",
   "DeletionPolicy": "Delete",
   "Metadata": {
    "aws:cdk:path": "KhayaStack/KhayaFrontendBucket/AutoDeleteObjectsCustomResource/Default"
   }
  },
  "CustomS3AutoDeleteObjectsCustomResourceProviderRole3B1BD092": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Version": "2012-10-17",
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "lambda.amazonaws.com"
       }
      }
     ]
    },
    "ManagedPolicyArns": [
     {
      "Fn::Sub": "arn:${AWS::Partition}:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "KhayaStack/Custom::S3AutoDeleteObjectsCustomResourceProvider/Role"
   }
  },
  "CustomS3AutoDeleteObjectsCustomResourceProviderHandler9D90184F": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Code": {
     "S3Bucket": "cdk-hnb659fds-assets-615608124862-us-east-1",
     "S3Key": "faa95a81ae7d7373f3e1f242268f904eb748d8d0fdd306e8a6fe515a1905a7d6.zip"
    },
    "Timeout": 900,
    "MemorySize": 128,
    "Handler": "index.handler",
    "Role": {
     "Fn::GetAtt": [
      "CustomS3AutoDeleteObjectsCustomResourceProviderRole3B1BD092",
      "Arn"
     ]
    },
    "Runtime": "nodejs22.x",
    "Description": {
     "Fn::Join": [
      "",
      [
       "Lambda function for auto-deleting objects in ",
       {
        "Ref": "KhayaFrontendBucket73A25EBF"
       },
       " S3 bucket."
      ]
     ]
    }
   },
   "DependsOn": [
    "CustomS3AutoDeleteObjectsCustomResourceProviderRole3B1BD092"
   ],
   "Metadata": {
    "aws:cdk:path": "KhayaStack/Custom::S3AutoDeleteObjectsCustomResourceProvider/Handler",
    "aws:asset:path": "asset.faa95a81ae7d7373f3e1f242268f904eb748d8d0fdd306e8a6fe515a1905a7d6",
    "aws:asset:property": "Code"
   }
  },
  "OAIE1EFC67F": {
   "Type": "AWS::CloudFront::CloudFrontOriginAccessIdentity",
   "Properties": {
    "CloudFrontOriginAccessIdentityConfig": {
     "Comment": "OAI for Khaya frontend bucket"
    }
   },
   "Metadata": {
    "aws:cdk:path": "KhayaStack/OAI/Resource"
   }
  },
  "KhayaCDN1B844B04": {
   "Type": "AWS::CloudFront::Distribution",
   "Properties": {
    "DistributionConfig": {
     "CacheBehaviors": [
      {
       "AllowedMethods": [
        "GET",
        "HEAD",
        "OPTIONS",
        "PUT",
        "PATCH",
        "POST",
        "DELETE"
       ],
       "CachePolicyId": "4135ea2d-6df8-44a3-9df3-4b5a84be39ad",
       "Compress": true,
       "OriginRequestPolicyId": "216adef6-5c7f-47e4-b989-5492eafa07d3",
       "PathPattern": "/api/*",
       "TargetOriginId": "KhayaStackKhayaCDNOrigin295A32F0B",
       "ViewerProtocolPolicy": "https-only"
      }
     ],
     "CustomErrorResponses": [
      {
       "ErrorCachingMinTTL": 300,
       "ErrorCode": 404,
       "ResponseCode": 200,
       "ResponsePagePath": "/index.html"
      },
      {
       "ErrorCachingMinTTL": 300,
       "ErrorCode": 403,
       "ResponseCode": 200,
       "ResponsePagePath": "/index.html"
      }
     ],
     "DefaultCacheBehavior": {
      "AllowedMethods": [
       "GET",
       "HEAD",
       "OPTIONS"
      ],
      "CachePolicyId": "658327ea-f89d-4fab-a63d-7e88639e58f6",
      "CachedMethods": [
       "GET",
       "HEAD",
       "OPTIONS"
      ],
      "Compress": true,
      "TargetOriginId": "KhayaStackKhayaCDNOrigin13CB54D1D",
      "ViewerProtocolPolicy": "redirect-to-https"
     },
     "DefaultRootObject": "index.html",
     "Enabled": true,
     "HttpVersion": "http2and3",
     "IPV6Enabled": true,
     "Origins": [
      {
       "CustomOriginConfig": {
        "OriginProtocolPolicy": "http-only",
        "OriginSSLProtocols": [
         "TLSv1.2"
        ]
       },
       "DomainName": {
        "Fn::Select": [
         2,
         {
          "Fn::Split": [
           "/",
           {
            "Fn::GetAtt": [
             "KhayaFrontendBucket73A25EBF",
             "WebsiteURL"
            ]
           }
          ]
         }
        ]
       },
       "Id": "KhayaStackKhayaCDNOrigin13CB54D1D"
      },
      {
       "CustomOriginConfig": {
        "OriginProtocolPolicy": "https-only",
        "OriginSSLProtocols": [
         "TLSv1.2"
        ]
       },
       "DomainName": {
        "Fn::Select": [
         2,
         {
          "Fn::Split": [
           "/",
           {
            "Fn::Join": [
             "",
             [
              "https://",
              {
               "Ref": "KhayaAPI20285BE5"
              },
              ".execute-api.us-east-1.",
              {
               "Ref": "AWS::URLSuffix"
              },
              "/",
              {
               "Ref": "KhayaAPIDeploymentStageprodDCC70FD3"
              },
              "/"
             ]
            ]
           }
          ]
         }
        ]
       },
       "Id": "KhayaStackKhayaCDNOrigin295A32F0B",
       "OriginPath": {
        "Fn::Join": [
         "",
         [
          "/",
          {
           "Fn::Select": [
            3,
            {
             "Fn::Split": [
              "/",
              {
               "Fn::Join": [
                "",
                [
                 "https://",
                 {
                  "Ref": "KhayaAPI20285BE5"
                 },
                 ".execute-api.us-east-1.",
                 {
                  "Ref": "AWS::URLSuffix"
                 },
                 "/",
                 {
                  "Ref": "KhayaAPIDeploymentStageprodDCC70FD3"
                 },
                 "/"
                ]
               ]
              }
             ]
            }
           ]
          }
         ]
        ]
       }
      }
     ],
     "PriceClass": "PriceClass_100"
    }
   },
   "Metadata": {
    "aws:cdk:path": "KhayaStack/KhayaCDN/Resource"
   }
  },
  "DailyTasksLambdaServiceRole2D874A07": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "lambda.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
       ]
      ]
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "KhayaStack/DailyTasksLambda/ServiceRole/Resource"
   }
  },
  "DailyTasksLambdaServiceRoleDefaultPolicyEB203DBA": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "dynamodb:BatchGetItem",
        "dynamodb:GetRecords",
        "dynamodb:GetShardIterator",
        "dynamodb:Query",
        "dynamodb:GetItem",
        "dynamodb:Scan",
        "dynamodb:ConditionCheckItem",
        "dynamodb:BatchWriteItem",
        "dynamodb:PutItem",
        "dynamodb:UpdateItem",
        "dynamodb:DeleteItem",
        "dynamodb:DescribeTable"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "JobsTable1970BC16",
          "Arn"
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "JobsTable1970BC16",
             "Arn"
            ]
           },
           "/index/*"
          ]
         ]
        }
       ]
      },
      {
       "Action": [
        "dynamodb:BatchGetItem",
        "dynamodb:GetRecords",
        "dynamodb:GetShardIterator",
        "dynamodb:Query",
        "dynamodb:GetItem",
        "dynamodb:Scan",
        "dynamodb:ConditionCheckItem",
        "dynamodb:BatchWriteItem",
        "dynamodb:PutItem",
        "dynamodb:UpdateItem",
        "dynamodb:DeleteItem",
        "dynamodb:DescribeTable"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "ListingsTableCCEBB5D2",
          "Arn"
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "ListingsTableCCEBB5D2",
             "Arn"
            ]
           },
           "/index/*"
          ]
         ]
        }
       ]
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "DailyTasksLambdaServiceRoleDefaultPolicyEB203DBA",
    "Roles": [
     {
      "Ref": "DailyTasksLambdaServiceRole2D874A07"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "KhayaStack/DailyTasksLambda/ServiceRole/DefaultPolicy/Resource"
   }
  },
  "DailyTasksLambda5FE227E9": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Code": {
     "S3Bucket": "cdk-hnb659fds-assets-615608124862-us-east-1",
     "S3Key": "4ae29b0fd63361d2386e24e8bc1b8451389a151a5c2fba3f3a70b6461e30da59.zip"
    },
    "Environment": {
     "Variables": {
      "JOBS_TABLE": {
       "Ref": "JobsTable1970BC16"
      },
      "LISTINGS_TABLE": {
       "Ref": "ListingsTableCCEBB5D2"
      }
     }
    },
    "Handler": "daily.handler",
    "Role": {
     "Fn::GetAtt": [
      "DailyTasksLambdaServiceRole2D874A07",
      "Arn"
     ]
    },
    "Runtime": "nodejs20.x",
    "Timeout": 300
   },
   "DependsOn": [
    "DailyTasksLambdaServiceRoleDefaultPolicyEB203DBA",
    "DailyTasksLambdaServiceRole2D874A07"
   ],
   "Metadata": {
    "aws:cdk:path": "KhayaStack/DailyTasksLambda/Resource",
    "aws:asset:path": "asset.4ae29b0fd63361d2386e24e8bc1b8451389a151a5c2fba3f3a70b6461e30da59",
    "aws:asset:is-bundled": false,
    "aws:asset:property": "Code"
   }
  },
  "DailyTasksRuleC088F1C1": {
   "Type": "AWS::Events::Rule",
   "Properties": {
    "Description": "Run daily maintenance tasks",
    "ScheduleExpression": "rate(1 day)",
    "State": "ENABLED",
    "Targets": [
     {
      "Arn": {
       "Fn::GetAtt": [
        "DailyTasksLambda5FE227E9",
        "Arn"
       ]
      },
      "Id": "Target0"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "KhayaStack/DailyTasksRule/Resource"
   }
  },
  "DailyTasksRuleAllowEventRuleKhayaStackDailyTasksLambda7F9034AC37F56998": {
   "Type": "AWS::Lambda::Permission",
   "Properties": {
    "Action": "lambda:InvokeFunction",
    "FunctionName": {
     "Fn::GetAtt": [
      "DailyTasksLambda5FE227E9",
      "Arn"
     ]
    },
    "Principal": "events.amazonaws.com",
    "SourceArn": {
     "Fn::GetAtt": [
      "DailyTasksRuleC088F1C1",
      "Arn"
     ]
    }
   },
   "Metadata": {
    "aws:cdk:path": "KhayaStack/DailyTasksRule/AllowEventRuleKhayaStackDailyTasksLambda7F9034AC"
   }
  },
  "CDKMetadata": {
   "Type": "AWS::CDK::Metadata",
   "Properties": {
    "Analytics": "v2:deflate64:H4sIAAAAAAAA/22RQW/bMAyFf0vvitZ5px7TFAV2GGq43bmQJdZjI4uBSCUzBP33QbbTGkNP/Kj3LPLJjW6aRt/emAvvrDvuPPY6P4uxR2Uu/JrdFMxIrtf5xfQe1OEtzFCUpSGgkM6/GWJL5Kv2wVc4eIQgW2k5KQrNqHNHy51zbcmjnWq7UFH8Q+f7ZI8w37DSUu4Nw4qf3237orwZe2d0fkzBClKoji23EEdkRgp10qthBmG9r0WZEw5G4GImnTtg2Z9w3vMT99ZSCqIe4ORpGteUm+5ZzDCHW6ADphQtzIv/AvlDroortZH+TlfLOmnmoqyn5N4iBdH5KeKAdTQw/3QQBGUOfqiex+r50vGALBH7dE2+7YuCMwRhnbu0/ozkoZSPhdX8IjUEhqHqT0lOSdQhsdD41c7/SW2kMzqINXlRgRzod/52bhr9/U7f3rwz4i6mIDiC7pb6DwKBJG2XAgAA"
   },
   "Metadata": {
    "aws:cdk:path": "KhayaStack/CDKMetadata/Default"
   }
  }
 },
 "Outputs": {
  "KhayaAPIEndpoint9221240C": {
   "Value": {
    "Fn::Join": [
     "",
     [
      "https://",
      {
       "Ref": "KhayaAPI20285BE5"
      },
      ".execute-api.us-east-1.",
      {
       "Ref": "AWS::URLSuffix"
      },
      "/",
      {
       "Ref": "KhayaAPIDeploymentStageprodDCC70FD3"
      },
      "/"
     ]
    ]
   }
  },
  "APIUrl": {
   "Description": "API Gateway URL",
   "Value": {
    "Fn::Join": [
     "",
     [
      "https://",
      {
       "Ref": "KhayaAPI20285BE5"
      },
      ".execute-api.us-east-1.",
      {
       "Ref": "AWS::URLSuffix"
      },
      "/",
      {
       "Ref": "KhayaAPIDeploymentStageprodDCC70FD3"
      },
      "/"
     ]
    ]
   },
   "Export": {
    "Name": "KhayaAPIUrl"
   }
  },
  "CDNUrl": {
   "Description": "CloudFront Distribution URL",
   "Value": {
    "Fn::Join": [
     "",
     [
      "https://",
      {
       "Fn::GetAtt": [
        "KhayaCDN1B844B04",
        "DomainName"
       ]
      }
     ]
    ]
   },
   "Export": {
    "Name": "KhayaCDNUrl"
   }
  },
  "DistributionId": {
   "Description": "CloudFront Distribution ID (for cache invalidation)",
   "Value": {
    "Ref": "KhayaCDN1B844B04"
   },
   "Export": {
    "Name": "KhayaDistributionId"
   }
  },
  "UserPoolId": {
   "Description": "Cognito User Pool ID",
   "Value": {
    "Ref": "KhayaUserPool64146B1C"
   },
   "Export": {
    "Name": "KhayaUserPoolId"
   }
  },
  "UserPoolClientId": {
   "Description": "Cognito User Pool Client ID",
   "Value": {
    "Ref": "KhayaAppClient7533AECC"
   },
   "Export": {
    "Name": "KhayaUserPoolClientId"
   }
  },
  "FrontendBucket": {
   "Description": "S3 Frontend Bucket Name",
   "Value": {
    "Ref": "KhayaFrontendBucket73A25EBF"
   },
   "Export": {
    "Name": "KhayaFrontendBucket"
   }
  },
  "StorageBucket": {
   "Description": "S3 Storage Bucket Name",
   "Value": {
    "Ref": "KhayaStorageBucket6A5AFBEB"
   },
   "Export": {
    "Name": "KhayaStorageBucket"
   }
  }
 },
 "Parameters": {
  "BootstrapVersion": {
   "Type": "AWS::SSM::Parameter::Value<String>",
   "Default": "/cdk-bootstrap/hnb659fds/version",
   "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]"
  }
 },
 "Rules": {
  "CheckBootstrapVersion": {
   "Assertions": [
    {
     "Assert": {
      "Fn::Not": [
       {
        "Fn::Contains": [
         [
          "1",
          "2",
          "3",
          "4",
          "5"
         ],
         {
          "Ref": "BootstrapVersion"
         }
        ]
       }
      ]
     },
     "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI."
    }
   ]
  }
 }
}